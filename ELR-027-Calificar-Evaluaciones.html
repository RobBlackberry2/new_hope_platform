<!doctype html>
<html lang="es">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ELR-027 - Calificar Evaluaciones</title>
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <div class="admin-container">
    <aside class="sidebar">
      <div class="brand">
        <div class="logo">NHS</div>
        <div>
          <div style="font-weight:700">New Hope School</div>
          <div style="font-size:12px;color:var(--muted)">E-Learning</div>
        </div>
      </div>
      <nav>
        <div
          style="font-size:11px;text-transform:uppercase;color:var(--muted);margin-bottom:8px;font-weight:800;letter-spacing:0.5px">
          M√≥dulo E-Learning</div>
        <a href="Elr-001-clase-virtual.html" class="active">
                    <span>üìö</span> Clases virtuales
                </a>
                <a href="Elr-004-Eliminar-secciones.html">
                    <span>üèÜ</span> Gamificaci√≥n
                </a>
                <a href="REF-002 - Generaci√≥n de Reportes Filtrados.html">
                    <span>üí¨</span> Foros
                </a>

                <div style="height:12px"></div>
                <div
                    style="font-size:11px;text-transform:uppercase;color:var(--muted);margin-bottom:8px;font-weight:800;letter-spacing:0.5px">
                    Navegaci√≥n Principal</div>
                <a href="index.html"><span>üè†</span> Inicio</a>
                <a href="Elr-001-clase-virtual.html"><span>üë®‚Äçüè´</span> Docentes</a>
                <a href="ELR‚Äë005-administrar-clases.html"><span>‚öôÔ∏è</span> Administrador</a>
                <a href="ELR‚Äë005-administrar-clases.html"><span>üéì</span> Estudiantes</a>
        <a href="ELR-028-Revisar-Calificaciones-y-Retroalimentaci√≥n.html"><span>üíª</span> E-Learning</a>
      </nav>
    </aside>

    <main class="hero">
      <div class="card">
        <h1>ELR-027: Calificar Evaluaciones</h1>
        <p class="lead">
          <strong>Historia de usuario:</strong> Como docente quiero poder calificar las evaluaciones tanto grupales como
          individuales para asignar notas y retroalimentaci√≥n.
        </p>

        <!-- Formulario de calificaci√≥n -->
        <form id="formCalificar">
          <label>ID Evaluaci√≥n</label>
          <input type="text" id="id_evaluacion" required />

          <label>Tipo de tarea</label>
          <select id="tipo_tarea" required>
            <option value="">Seleccione</option>
            <option value="individual">Individual</option>
            <option value="grupal">Grupal</option>
          </select>

          <label>Nota</label>
          <input type="number" id="nota" min="0" max="100" />

          <label>Retroalimentaci√≥n</label>
          <textarea id="retroalimentacion" rows="3"></textarea>

          <button type="submit">Guardar Calificaci√≥n</button>
          <div id="mensaje" class="msg"></div>
        </form>

        <!-- Resultado -->
        <h3 style="margin-top:20px">Resultado</h3>
        <div id="resultado" class="lista"></div>
      </div>
    </main>

    <footer>
      <div style="max-width:800px;margin:0 auto">
        ¬© <span id="year"></span> New Hope Digital Learning
        <span style="color:var(--muted)">Versi√≥n demo</span>
      </div>
    </footer>
  </div>

  <script>
    const form = document.getElementById('formCalificar');
    const mensaje = document.getElementById('mensaje');
    const resultado = document.getElementById('resultado');

    form.addEventListener('submit', function (e) {
      e.preventDefault();

      const idEvaluacion = id_evaluacion.value.trim();
      const tipoTarea = tipo_tarea.value.trim();
      const notaValor = nota.value.trim();
      const retro = retroalimentacion.value.trim();

      // Simulaci√≥n de error de conexi√≥n (10% probabilidad)
      const falloConexion = Math.random() < 0.1;
      if (falloConexion) {
        mostrarMensaje('err', 'No fue posible realizar la acci√≥n. Intente nuevamente m√°s tarde.');
        return;
      }

      // Validaci√≥n: campos vac√≠os
      if (!idEvaluacion || !tipoTarea) {
        mostrarMensaje('err', 'Hay campos obligatorios sin completar.');
        return;
      }

      // Caso 2: Calificaci√≥n autom√°tica (formularios)
      if (tipoTarea === "formulario") {
        const respuestasCorrectas = ["A", "B", "C"];
        const respuestasEstudiante = ["A", "", "C"]; // simulaci√≥n
        let aciertos = 0;
        respuestasEstudiante.forEach((r, i) => {
          if (r && r === respuestasCorrectas[i]) aciertos++;
        });
        const notaAuto = (aciertos / respuestasCorrectas.length) * 100;
        mostrarMensaje('ok', 'La tarea fue calificada autom√°ticamente.');
        resultado.innerHTML = `<div class="form-contenido">
        <strong>ID Evaluaci√≥n:</strong> ${idEvaluacion}<br>
        Tipo: Formulario<br>
        Nota autom√°tica: ${notaAuto.toFixed(2)}%
      </div>`;
        return;
      }

      // Caso 3: Tarea no enviada
      if (!notaValor && tipoTarea !== "formulario") {
        mostrarMensaje('err', 'La tarea no fue enviada. Se asigna nota 0.');
        resultado.innerHTML = `<div class="form-contenido">
        <strong>ID Evaluaci√≥n:</strong> ${idEvaluacion}<br>
        Tipo: ${tipoTarea}<br>
        Nota: 0<br>
        Estado: ‚ùå No enviada
      </div>`;
        return;
      }

      // Caso 4: Tarea incompleta (simulaci√≥n: nota < 50)
      if (notaValor && parseInt(notaValor) < 50) {
        mostrarMensaje('ok', 'La tarea estaba incompleta. Se calificaron las respuestas enviadas.');
        resultado.innerHTML = `<div class="form-contenido">
        <strong>ID Evaluaci√≥n:</strong> ${idEvaluacion}<br>
        Tipo: ${tipoTarea}<br>
        Nota: ${notaValor}<br>
        Estado: ‚ö†Ô∏è Incompleta
      </div>`;
        return;
      }

      // Caso 1: Calificaci√≥n exitosa
      mostrarMensaje('ok', 'La tarea fue revisada con √©xito.');
      resultado.innerHTML = `<div class="form-contenido">
      <strong>ID Evaluaci√≥n:</strong> ${idEvaluacion}<br>
      Tipo: ${tipoTarea}<br>
      Nota: ${notaValor}<br>
      Retroalimentaci√≥n: ${retro || "Sin comentarios"}<br>
      Estado: ‚úÖ Calificada
    </div>`;
      form.reset();
    });

    function mostrarMensaje(tipo, texto) {
      mensaje.className = 'msg ' + (tipo === 'ok' ? 'ok' : 'err');
      mensaje.textContent = texto;
      mensaje.style.display = 'block';
    }

    // A√±o din√°mico en footer
    document.getElementById('year').textContent = new Date().getFullYear();
  </script>
</body>

</html>